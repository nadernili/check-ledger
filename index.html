<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Simple Check Ledger</title>
  <style>
    :root{ --bg:#f7f8fb; --card:#fff; --text:#111827; --muted:#6b7280; --green:#16a34a; --red:#dc2626; --border:#e5e7eb; }
    html,body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial,sans-serif;background:var(--bg);color:var(--text)}
    .container{max-width:1100px;margin:24px auto;padding:0 16px}
    .card{background:var(--card);border-radius:14px;box-shadow:0 8px 24px rgba(0,0,0,.06);padding:16px}
    .header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:16px}
    h1{font-size:22px;margin:0}
    .row{display:flex;gap:16px;flex-wrap:wrap}
    .col{flex:1 1 360px}
    label{display:block;font-size:12px;color:var(--muted);margin:6px 0 4px}
    input,select,textarea{width:100%;padding:10px;border:1px solid var(--border);border-radius:10px;background:#fff}
    .btn{border:none;border-radius:10px;padding:10px 14px;cursor:pointer;background:#111827;color:#fff}
    .btn.secondary{background:#374151}
    .btn.danger{background:#991b1b}
    .badges{display:flex;gap:10px;align-items:center;margin:8px 0}
    .badge{font-size:12px;padding:4px 8px;border-radius:999px;background:#eef2f7;color:#111827;border:1px solid var(--border)}
    .badge.deposit{background:#dcfce7;color:#166534;border-color:#c7f2d5}
    .badge.payment{background:#fee2e2;color:#991b1b;border-color:#f7caca}
    table{width:100%;border-collapse:separate;border-spacing:0 8px}
    thead th{font-size:12px;color:var(--muted);text-align:left;padding:0 10px}
    tbody tr{background:#fff;box-shadow:0 2px 8px rgba(0,0,0,.05)}
    td{padding:10px;border-top:1px solid var(--border);border-bottom:1px solid var(--border)}
    tbody tr td:first-child{border-left:1px solid var(--border);border-top-left-radius:10px;border-bottom-left-radius:10px}
    tbody tr td:last-child{border-right:1px solid var(--border);border-top-right-radius:10px;border-bottom-right-radius:10px}
    .type-pill{display:inline-block;padding:4px 8px;border-radius:999px;color:#fff;font-weight:600}
    .type-deposit{background:var(--green)}
    .type-payment{background:var(--red)}
    .totals{display:flex;gap:12px;flex-wrap:wrap;margin:10px 0}
    .totals .badge{font-weight:600}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap;align-items:center;justify-content:space-between;margin:8px 0 14px}
    .muted{color:var(--muted)}
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Simple Check Ledger</h1>
      <div style="display:flex;gap:8px">
        <button class="btn" id="exportCsv">Export CSV</button>
        <button class="btn secondary" id="clearAll">Clear All</button>
      </div>
    </div>

    <div class="row">
      <div class="col">
        <div class="card">
          <h3 style="margin:0 0 10px">Add Deposit / Payment</h3>
          <label>Type</label>
          <select id="type">
            <option value="deposit">Deposit</option>
            <option value="payment">Payment</option>
          </select>

          <label>Date</label>
          <input type="date" id="date" />

          <label>Name / Title</label>
          <input id="title" placeholder="e.g., Client payment or Utilities" />

          <label>Amount</label>
          <input type="number" step="0.01" id="amount" placeholder="0.00" />

          <label>Check # (optional)</label>
          <input id="checknum" />

          <label>Payee (optional)</label>
          <input id="payee" />

          <label>Notes (optional)</label>
          <textarea id="notes" rows="3"></textarea>

          <div style="display:flex;gap:8px;margin-top:12px">
            <button class="btn" id="addBtn">Add</button>
            <button class="btn secondary" id="resetForm">Reset</button>
          </div>
        </div>
      </div>

      <div class="col">
        <div class="card">
          <div class="toolbar">
            <div style="display:flex;gap:8px;align-items:center">
              <button class="btn" data-range="week">This Week</button>
              <button class="btn secondary" data-range="month">This Month</button>
              <button class="btn secondary" data-range="custom">Custom</button>
              <input type="date" id="startDate" style="display:none" />
              <input type="date" id="endDate" style="display:none" />
            </div>
            <div class="badges">
              <span class="badge deposit" id="sumDeposits">Deposits: $0.00</span>
              <span class="badge payment" id="sumPayments">Payments: $0.00</span>
              <span class="badge" id="sumNet">Net: $0.00</span>
            </div>
          </div>

          <div class="muted" style="margin-bottom:6px">Entries (newest first)</div>
          <div style="overflow:auto">
            <table>
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Type</th>
                  <th>Title</th>
                  <th>Amount</th>
                  <th>Check #</th>
                  <th>Payee</th>
                  <th>Notes</th>
                  <th></th>
                </tr>
              </thead>
              <tbody id="rows"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <p class="muted" style="margin-top:12px">ðŸ’¾ Your data is saved in your browser (localStorage). Clearing browser data will remove it. No login required.</p>
  </div>

  <script>
  // Storage utilities
  const KEY = 'check_ledger_v1';
  const $ = s => document.querySelector(s);
  const $$ = s => Array.from(document.querySelectorAll(s));

  function load(){
    try { return JSON.parse(localStorage.getItem(KEY)) || [] } catch { return [] }
  }
  function save(list){ localStorage.setItem(KEY, JSON.stringify(list)) }

  // Elements
  const typeEl = $('#type');
  const dateEl = $('#date');
  const titleEl = $('#title');
  const amountEl = $('#amount');
  const checkEl = $('#checknum');
  const payeeEl = $('#payee');
  const notesEl = $('#notes');
  const rowsEl = $('#rows');
  const addBtn = $('#addBtn');
  const resetBtn = $('#resetForm');
  const clearAllBtn = $('#clearAll');
  const exportBtn = $('#exportCsv');
  const btnWeek = document.querySelector('[data-range="week"]');
  const btnMonth = document.querySelector('[data-range="month"]');
  const btnCustom = document.querySelector('[data-range="custom"]');
  const startDate = $('#startDate');
  const endDate = $('#endDate');
  const sumDeposits = $('#sumDeposits');
  const sumPayments = $('#sumPayments');
  const sumNet = $('#sumNet');

  // Setup: default today
  const todayISO = () => new Date().toISOString().slice(0,10);
  dateEl.value = todayISO();

  // Data
  let items = load();
  let range = 'week'; // week | month | custom

  function withinRange(d){
    const {start, end} = currentRange();
    return (!start || d >= start) && (!end || d <= end);
  }

  function currentRange(){
    const toISO = d => d.toISOString().slice(0,10);
    const now = new Date();
    if (range === 'week'){
      const day = now.getDay(); // 0 Sun
      const monday = new Date(now); monday.setDate(now.getDate() - ((day+6)%7));
      const sunday = new Date(monday); sunday.setDate(monday.getDate()+6);
      return { start: toISO(monday), end: toISO(sunday) };
    }
    if (range === 'month'){
      const first = new Date(now.getFullYear(), now.getMonth(), 1);
      const last = new Date(now.getFullYear(), now.getMonth()+1, 0);
      return { start: toISO(first), end: toISO(last) };
    }
    return { start: startDate.value || null, end: endDate.value || null };
  }

  function render(){
    // Filter + sort newest first by date then id
    const filtered = items
      .filter(it => withinRange(it.date))
      .sort((a,b)=> (a.date < b.date ? 1 : a.date > b.date ? -1 : (b.id - a.id)));

    rowsEl.innerHTML = '';
    let dep = 0, pay = 0;

    for (const it of filtered){
      if (it.type === 'deposit') dep += +it.amount; else pay += +it.amount;
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${it.date}</td>
        <td><span class="type-pill ${it.type==='deposit'?'type-deposit':'type-payment'}">${it.type}</span></td>
        <td>${escapeHtml(it.title)}</td>
        <td>$${Number(it.amount).toFixed(2)}</td>
        <td>${escapeHtml(it.check_number||'')}</td>
        <td>${escapeHtml(it.payee||'')}</td>
        <td>${escapeHtml(it.notes||'')}</td>
        <td style="text-align:right">
          <button class="btn secondary" data-edit="${it.id}">Edit</button>
          <button class="btn danger" data-del="${it.id}">Delete</button>
        </td>`;
      rowsEl.appendChild(tr);
    }

    sumDeposits.textContent = `Deposits: $${dep.toFixed(2)}`;
    sumPayments.textContent = `Payments: $${pay.toFixed(2)}`;
    sumNet.textContent = `Net: $${(dep - pay).toFixed(2)}`;
  }

  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[c]))
  }

  function addItem(){
    const item = {
      id: Date.now(),
      type: typeEl.value,
      date: dateEl.value || todayISO(),
      title: titleEl.value.trim(),
      amount: Number(amountEl.value || 0),
      check_number: checkEl.value.trim() || null,
      payee: payeeEl.value.trim() || null,
      notes: notesEl.value.trim() || null
    };
    if (!item.title || !item.amount){
      alert('Please enter title and amount.');
      return;
    }
    items.push(item); save(items); render();
    // reset some fields
    titleEl.value = ''; amountEl.value=''; checkEl.value=''; payeeEl.value=''; notesEl.value='';
  }

  function delItem(id){
    items = items.filter(x => x.id !== id); save(items); render();
  }

  function editItem(id){
    const it = items.find(x => x.id === id); if (!it) return;
    // Load into form
    typeEl.value = it.type; dateEl.value = it.date; titleEl.value = it.title; amountEl.value = it.amount; checkEl.value = it.check_number||''; payeeEl.value = it.payee||''; notesEl.value = it.notes||'';
    // Replace Add with Save
    addBtn.textContent = 'Save Changes';
    addBtn.onclick = () => {
      it.type = typeEl.value; it.date = dateEl.value; it.title = titleEl.value.trim(); it.amount = Number(amountEl.value||0); it.check_number = checkEl.value.trim()||null; it.payee = payeeEl.value.trim()||null; it.notes = notesEl.value.trim()||null;
      if (!it.title || !it.amount){ alert('Please enter title and amount.'); return; }
      save(items); render();
      addBtn.textContent = 'Add'; addBtn.onclick = addItem; resetForm();
    };
  }

  function resetForm(){
    typeEl.value = 'deposit'; dateEl.value = todayISO(); titleEl.value = ''; amountEl.value = ''; checkEl.value=''; payeeEl.value=''; notesEl.value='';
  }

  // CSV export
  function toCsv(arr){
    const header = ['id','date','type','title','amount','check_number','payee','notes'];
    const rows = arr.map(o => header.map(k => JSON.stringify(o[k] ?? '')).join(','));
    return header.join(',') + '\n' + rows.join('\n');
  }
  function downloadCsv(){
    const {start,end} = currentRange();
    const data = items.filter(it => withinRange(it.date));
    const blob = new Blob([toCsv(data)], {type:'text/csv'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = `check-ledger_${start||'all'}_${end||'all'}.csv`;
    a.click();
  }

  // Events
  addBtn.onclick = addItem;
  resetBtn.onclick = resetForm;
  clearAllBtn.onclick = () => { if (confirm('Clear ALL entries?')) { items = []; save(items); render(); } };
  exportBtn.onclick = downloadCsv;

  btnWeek.onclick = () => { range = 'week'; btnWeek.classList.remove('secondary'); btnMonth.classList.add('secondary'); btnCustom.classList.add('secondary'); startDate.style.display='none'; endDate.style.display='none'; render(); };
  btnMonth.onclick = () => { range = 'month'; btnWeek.classList.add('secondary'); btnMonth.classList.remove('secondary'); btnCustom.classList.add('secondary'); startDate.style.display='none'; endDate.style.display='none'; render(); };
  btnCustom.onclick = () => { range = 'custom'; btnWeek.classList.add('secondary'); btnMonth.classList.add('secondary'); btnCustom.classList.remove('secondary'); startDate.style.display='inline-block'; endDate.style.display='inline-block'; render(); };
  startDate.onchange = endDate.onchange = () => { if(range==='custom') render(); };

  // Initial paint
  render();

  </script>
</body>
</html>
